# rovrov フロントエンドMVP企画書

## プロダクト概要
- **アプリ名称**: rovrov
- **目指す体験**
    - 日常の小さな冒険や体験を写真・動画とともに地図へ記録し、鮮明な思い出として残すことで人生を豊かにする。
    - 自分が良かった小さな冒険・体験を共有し合い、ユーザーが小さな冒険・体験へ一歩踏み出すきっかけを提供する。
    - 日常を小さな旅行のように楽しめるSNSコミュニティを実現する。

## 技術スタック
- **フロントエンド（モバイル）**: React Native + Expo + TypeScript
- **状態管理**: Zustand + React Query
- **バックエンド**: Supabase（PostgreSQL + Edge Functions）
- **認証**: Supabase Auth（Magic Link）
- **画像処理**: Supabase Storage + Smart CDN + Image Transformations（オンザフライ最適化）
- **動画処理**: Cloudflare Stream（保管・トランスコード・配信）
- **地図**: react-native-maps（Google Maps SDK）+ Google Places API + Cloud-based Maps Styling
- **キャッシュ**: 多層戦略（L1: React Query / L2: Redis〈Upstash、段階的導入〉 / L3: Smart CDN / L4: Cloudflare Stream）
- **リアルタイム**: Supabase Realtime
- **メール配信**: SendGrid
- **監視**: Sentry + Vercel Analytics

## コア機能スコープ
- **タイムライン（TL）**: 投稿を1カラムで閲覧するフィード体験。
- **マップ（Map）**: 行きたい・行った場所を探索できる地図体験。
- **通知（Notification）**: フィードバックや更新情報の受信（仕様別途策定）。
- **アカウント（Account）**: プロフィール・設定管理（仕様別途策定）。
- **投稿（Post）**: 写真・動画と位置情報を添えて体験を記録・共有。

## 共通UI/ナビゲーション設計
- **ボトムナビゲーションバー**
    - 高さ48px。
    - アイコンはRemix Iconを使用（`import { IconName } from "react-icons/ri";`）。
    - 未選択状態は `-Line`、選択状態は `-Fill` を利用して視覚的な切り替えを明確化。
- **Split Bottom Navigation（Split Tab Bar）**
    - 左セクション：TL（`ri/RiLayout2Line` / `ri/RiLayout2Fill`）、Map（`ri/RiMapLine` / `ri/RiMapFill`）、Notification（`ri/RiNotification4Line` / `ri/RiNotification4Fill`）、Account（`ri/RiAccountPinCircleLine` / `ri/RiAccountPinCircleFill`）。下方向へのスクロールで自動的にフェードアウト。
    - 中央セクション：1アイコン分のスペースを空け、全体のバランスを調整。
    - 右セクション：Post（`ri/RiAddLine`）。スクロールの有無に関係なく常時表示し、FAB的な位置づけを担う。

## 機能詳細

### 投稿（Post）
#### 目的
- ユーザーが最短経路で投稿を完了できる体験を提供する。

#### KPI
- 月あたりの投稿FABクリック回数。
- 月あたりのFAB経由投稿完了数。
- 投稿完了率（FAB経由投稿完了数 ÷ 投稿FABクリック回数）。

#### 主なユースケース
- 外出先で食事前などに即時投稿する。
- その日の終わりにまとめて投稿する。

#### 設計指針
- FABタップから最短2ステップで投稿完了（撮影を行う場合は3ステップ）。
    - FAB → イメージピッカー → 一言／場所の指定 → 投稿。
    - FAB → イメージピッカー → 撮影 → 一言／場所の指定 → 投稿。
- 行った場所・体験を記録したくなるコピーと導線を設ける。
- EXIF情報や現在地から近い場所タグをサジェストし、位置情報入力のハードルを下げる。

#### ユーザーフローとUI要素
- **FABタップ**：Twitterライクなイメージピッカーを起動。正方形ブロックで「写真を撮る」と「写真を追加」の両方を提供。
- **メディア選択後のメッセージカード**（ChatGPT/Claudeの入力カード風に下から出現）：
    - 選択済み写真を正方形で並べて表示。
        - 各写真右上に×アイコン（タップで選択解除）。
        - 各写真左下に公開設定アイコン。タップでインラインメニューを開き、`public`（地球アイコン）/`friends`（人が2人のアイコン）/`secret`（南京錠アイコン）を選択。選択結果を反映したアイコンを表示。
    - 「どこにいったの？」テキスト：タップでPin選択用ボトムシートを表示。
        - 現在地に近いPinをサジェスト表示。
        - 検索バーを備え、任意検索に対応。
        - Pin選択後はテキストボックスを非表示にし、後述のPinアイコンをアクティブ（青）表示。
    - 「ひとこと」プレースホルダー：キャプション入力用テキストインプット。
    - 「タグ」プレースホルダー：タグ入力用テキストインプット。スペースまたはEnterで確定し、各タグにバツボタンを付与。
    - Pinアイコン：タップでボトムシートを再表示。選択済みの場合は青く表示。
    - 写真アイコン：タップでイメージピッカーを再度開き、選択済みの場合は青く表示。
    - 送信ボタン：写真未選択時は非活性。
    - 詳細設定アイコン：別画面を開き、以下を編集可能にする。
        - Pin入力テキストボックス：タップでボトムシートを再表示。選択済みPinはテキストボックスに表示。
        - 訪問日時テキストボックス：タップでカレンダーモーダル → 時刻ピッカーの順に表示し、選択値を反映。
        - 同行者テキストボックス：タップでフォロワー選択モーダルを開き、選択ユーザー名を表示。

#### 入力項目
- 写真（必須、最大8枚。各写真に公開設定：public/friends/secret）。
- 場所（1投稿につきPinは1つまで）。
- キャプション（最大140字）。
- タグ。
- 訪れた日時（デフォルトは投稿日時）。
- 一緒に行った人。

### タイムライン（TL）
#### 目的
- 目的意識が低い状態でも気軽に投稿を眺められる体験を提供し、情報収集・共感・コミュニティへの安心感につなげる。

#### KPI
- タイムライン経由のブックマーク数。
- 他ユーザーの投稿へのいいね数。
- タイムライン滞在時間。
- タイムラインからの共有数。

#### 主なユースケース
- やることがない時間（気力がない時や隙間時間）に無心でフィードを眺める。

#### ユーザーフローとUI要素
- ログイン済みでアプリ起動時、タイムラインを初期表示。前回起動から30分以上経過していれば自動で更新。
- 投稿は1カラムで縦並び。読込中はレイアウト忠実なスケルトンにシマーアニメーションを付与。
- **Postコンポーネント構成**
    - **PostImageBlock（画像グリッド全体・配置ロジック）**
        - アスペクト比は5:4の横長。左右余白なしのフルブリード。
        - ImageTile（個別タイル）とImageGrid（レイアウト切替）で構成。
        - 複数枚の境界線は0.3〜0.5px（デバイスに合わせて調整）。
        - レイアウト基準：`W = usable width = calc(100vw - env(safe-area-inset-left) - env(safe-area-inset-right))`
            - **1枚**：幅 W、高さ 0.8W（= W × 4/5）。
            - **2枚（横2枚）**：各幅 0.5W、各高さ 0.4W。
            - **3枚（左ヒーロー + 右縦2枚）**：左幅 2/3W → 高さ 0.6667W × 4/5 = 0.5333W。右幅 1/3W → 各高さ 0.3333W × 4/5 = 0.2667W（合計0.5333W）。
            - **4枚（2×2グリッド）**：各幅 0.5W、各高さ 0.4W。全体高さ 0.8W。
            - **5枚（左ヒーロー + 右2×2）**：左幅 0.5W → 高さ 0.5W × 4/5 = 0.4W。右セル幅 0.25W → 各高さ 0.25W × 4/5 = 0.2W（上下合計0.4W）。
    - **PostHeader**
        - 左にPostMainInfo（ユーザーID・日付・行った場所を縦積み表示）。
        - 右にPostActions（左から いいね / ブックマーク / 共有 / 3点リーダーメニュー）。
            - いいね：`ri/RiHeartLine` / `ri/RiHeartFill`
            - ブックマーク：`ri/RiBookmarkLine` / `ri/RiBookmarkFill`
            - 共有：`ri/RiShare2Line`
            - メニュー：`ri/RiMoreLine`
    - **PostBody**
        - PostText：本文はデフォルト2行まで表示し、「続きを見る」ボタンで全文展開。

### 投稿詳細（TL Detail）
#### 目的
- タイムラインからタップした投稿の詳細を確認できるようにする。

#### KPI
- 特になし。

#### 主なユースケース
- 投稿内容をより詳しく確認したい。
- 写真を拡大表示したい。

#### 設計指針
- 関連投稿を連続表示する仕組みは将来的に検討（MVPでは対象外）。

#### ユーザーフローとUI要素
- タイムラインの画像タップで詳細画面へ遷移。
- 共有要素トランジション（Shared Element Transition）でスムーズに遷移。React Native Reanimated / native-stack（`sharedTransitionTag` など）を利用。
- **詳細画面構成**
    - PostImageList：画像を縦並びに表示。左右余白なしのフルブリード。横幅基準でアスペクトを維持し、画像間の境界線は0.3px。
    - PostMainInfo：ユーザーID・日付・行った場所を縦積み。
    - PostFullBody：本文全文とタグリストを表示。
    - Map：行った場所がある場合に表示。アスペクト比5:4で該当地域を表示。

### マップ（Map）
#### 目的
- 行きたい場所を見つける「発見」と、忘れていた行きたかった場所を思い出す「想起」を実現する。

#### KPI
- マップ機能の遷移率（マップ利用日数 ÷ アプリ起動日数）。
- マップ機能の滞在時間。
- マップ上でのブックマーク回数。
- ブックマークしたPinのタップ回数。

#### 主なユースケース
- 外出先で行きたい場所を探す。
- 予定を立てる際に目的地周辺のスポットを調べる。
- 暇な時間にトレンドや賑わっている場所を探索する。

#### 設計指針
- 地図上の旅を促す「発見」と「想起」を両立するUI。
    - トレンドスポットを探す動機付け。
    - 現在地付近の過去ブックマークに気づける導線。
- 片手操作できる範囲に主要操作を集約。

#### ユーザーフローとUI要素
- ボトムタブのMapアイコンタップでマップ画面を表示。Google Mapを使用。
- ナビゲーションバーは上部に配置。ステータスバーは透過し、その直下にアイコンを置かない。
- 検索バーは画面最下部。タップで上方向に検索候補リストを展開（Safariの検索画面ライク）。
- **検索候補の対象とアイコン**
    - 国：`ri/RiGlobeLine`
    - Admin1・Admin2：`ri/RiRoadMapLine`
    - 駅：`ri/RiSubwayLine`
    - ホテル：`ri/RiHotelLine`
    - 空港：`ri/RiPlaneFill`
    - 船場：`ri/RiShipLine`
    - Pin（場所タグ）：`ri/RiMapPin2Line`
    - ハッシュタグ：`ri/RiHashtag`
- ハッシュタグ検索はスペース区切りで複数キーワードに対応。
- 国・Admin1・Admin2・駅・Pinを選択した場合は該当地域へ移動し、ビューポートに合わせてズーム。
- ハッシュタグを選択した場合は、現在の表示範囲に関連するスポットへフラグを表示。必要に応じてGoogle Maps Platformの「マーカー・クラスタリング」ユーティリティを利用。
- 検索後は、現在の地図中心から近いスポット候補をカード型カルーセルで提示。横スクロールに合わせて地図上のPinも同期して切り替える。
