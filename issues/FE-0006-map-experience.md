---
id: FE-0006
title: マップ画面の検索・カルーセルUI実装
type: feature
area: frontend
epic: EPIC-FE-MVP
---

## 概要
Map タブで地図探索体験を提供するため、検索バー・候補リスト・カルーセル・Pin 表示を `docs/proposal.md` の仕様で実装し、発見と想起が両立する UI を構築する。

## 背景・目的
- `docs/proposal.md` では、地図上でトレンドや過去の行きたい場所を探せる体験が求められている。
- 検索バーを画面下に配置し、候補リストが上に伸びる Safari ライクな挙動を実現する必要がある。

## 受け入れ基準 (Acceptance Criteria)
- Map タブを開くと Google Maps SDK が表示され、ステータスバーは透過、上部にナビゲーションバー (透明背景) が置かれる。
- 画面下部の検索バー (高さ 56px) をタップすると、画面上部から候補リストが `motion-content` でスライドダウンし、国/Admin/駅/空港/船場/ホテル/Pin/ハッシュタグを表示する。
- 各候補にはカテゴリに応じた Remix Icon が 24px サイズで付き、候補タップで地図が指定位置に移動。ハッシュタグの場合、表示中の領域に関連スポット Pin (クラスタリング対応) が立つ。
- 検索結果取得後、地図中心付近のスポットをカード型カルーセルで表示。カード swipe に連動してマップの Pin がハイライトされる。
- 片手操作を前提に、検索バーとカルーセルは下部 220px 内に収まり、iPhone 15 Pro (iOS26) で親指が届く。
- アクセス権限エラー (位置情報未許可) では半透明のアラートを表示し、擬似位置にフォールバックする。

## 実装スコープ
- Frontend: MapScreen、検索バー、候補リスト、カルーセル、Pin レンダリング、位置情報ハンドリング、モックデータ/API。
- Backend: モックデータ (`fixtures/places.json`) のみ。
- Infra: `.env` で Google Maps API Key を管理。

## 実装計画
- **画面構成**: 背景は地図。上部 72px に透明ナビゲーションバー (戻る無し、右に設定アイコン)。下部に半透明の検索バー (角丸 24px) を固定。Apple Maps iOS26 の検索レイヤを参考に、ガラス風の `rgba(255,255,255,0.78)`。
- **検索バー**: 左に検索アイコン 24px、中央に `typo-body` プレースホルダー、右に音声アイコン (将来用) のスペースを確保。フォーカス時はバーが `motion-content` で僅かに上昇し (4px)、影が強くなる。
- **候補リスト**: 画面上から高さ 62% のシートが降りてくる。各リストアイテム 60px、高さ `space-16` の余白。左にカテゴリアイコン、中央に名称、右に「過去訪問済み」バッジなどを `typo-footnote` で表示。背景 `blur(24px)` + 白 65%。
- **カルーセル**: 画面下 180px の高さに水平カルーセル。各カードは 260×140px、背景 `rgba(16,18,24,0.92)`、テキスト白。カードを 10px チルトさせ、Snap 動作を Reanimated で実装。カード選択時にマップ Pin を `scale:1.2` で強調。
- **Pin/クラスタリング**: Google Maps の Marker Clustering を有効化し、ズームアウト時はクラスタバッジ (直径 44px、背景アクセントカラー) を表示。個別 Pin は `color-text-title` をベースに、リング付きのフラットデザイン。
- **位置情報エラーUI**: 画面中央に 280×200px のカードを表示。上部に Location Off アイコン (32px)、本文 `typo-body`、下部に「設定を開く」「閉じる」の 2 ボタン。背景 `surfaceGlass`、モーション `motion-content`。

## 実装メモ / 注意点
- Google Maps API Key は `.env` 経由で読み込み、Expo Config で注入。
- カルーセル→マップ同期は Zustand で state を共有し、`useEffect` で `map.animateCamera` を呼ぶ。
- 候補検索はローカルモックで前方一致 + ハッシュタグ (#) プレフィックス対応。
- ハッシュタグ選択時の Pin 表示は最大 12 件に制限し、リストにも同じ順序で並べる。

## Definition of Done
- 候補選択→カルーセル同期→Pin 強調の流れを iOS26/Android で録画し PR に添付。
- 検索フィルターロジックやカルーセル同期のユニットテストが通る。
- `yarn lint`・`yarn tsc --noEmit` が成功。
- デザインレビュー・コードレビューを各1件取得。
