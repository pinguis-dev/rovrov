---
id: FE-0003
title: PostフローUI（イメージピッカー〜投稿設定）の実装
type: feature
area: frontend
epic: EPIC-FE-MVP
---

## 概要
Post FAB から起動する投稿フローを構築し、画像最大8枚・公開設定・位置タグ・タグ・キャプション・同行者・訪問日時を入力できる UI を `docs/proposal.md` の仕様通りに提供する。

## 背景・目的
- `docs/proposal.md` において、最短 2 ステップで投稿できる体験がアプリの中核と定義されている。
- 投稿画面の UI/UX を明確に実装することで、タイムラインやマップとのデータ連携が成立する。

## 受け入れ基準 (Acceptance Criteria)
- Post FAB をタップするとイメージピッカーがフルスクリーンで開く。タイルは正方形で、先頭セルに「写真を撮る」ブロック、残りにカメラロールのプレビューを表示。
- 写真選択後、ボトムから投稿カードが表示され、以下要素が含まれる:
    - 選択写真の正方形プレビュー (最大8枚)。右上に削除 ×、左下に公開範囲アイコン (public/friends/secret)。
    - 「どこにいったの？」入力 (未選択時テキストフィールド)、Pin 選択ボトムシートへの導線。
    - キャプション (140文字制限 + 残り文字数カウンター)。
    - タグ入力 (スペース/Enterでチップ化、削除ボタン付き)。
    - Pinアイコン・写真アイコン・詳細設定アイコン (位置・写真再選択・詳細設定を開く)。
    - 送信ボタン (写真未選択時は disabled 表示)。
- 詳細設定画面で Pin 再選択、訪問日時 (日付→時間の順にモーダル)、同行者 (フォロワー一覧モーダル) のUIが表示され、いずれも値がリフレクトされる。
- Pin 選択ボトムシートには現在地ベースのサジェスト (モック5件) と検索バーがあり、検索結果でリストがフィルタされる。
- 送信時に入力内容が検証され、`mutatePost` モック API へ payload が渡る。成功で「投稿完了」トーストを `motion-hero` で表示、失敗時はエラートースト (セマンティック文言) を表示。
- カメラ権限未許可時は `docs/design_animation_rules.md` に倣った半透明アラート (モーダル) を表示。

## 実装スコープ
- Frontend: イメージピッカー UI、投稿カード画面、公開設定メニュー、Pin ボトムシート、詳細設定モーダル、タグ入力、モック API フック、バリデーションユーティリティ。
- Backend: モック API (`mutatePost`) のみ。
- Infra: 対象外。

## 実装計画
- **イメージピッカー**: X (旧Twitter) iOS26 の投稿モーダルを参考に、フルスクリーンで 2 列の正方形タイルを表示。タイルサイズは `width/2 - 12`、ギャップ `space-8`。先頭セルはカメラアイコン + 「撮影」テキスト、背景 `rgba(255,255,255,0.3)` でガラス感を出す。
- **投稿カード**: 下部 72% の領域に `surfaceGlass` 背景を敷いたカードを表示。ヘッダーに 32px のドラッグハンドル、中段に写真グリッド (横スクロール) と情報フォームを縦積み。iOS26 Photos の情報シートと同じく上下角半径 28px。
- **写真プレビュー**: 各写真は 120px の正方形。右上の削除ボタンは 20px 円形 (背景 `rgba(0,0,0,0.55)`)、左下公開アイコンは 24px。選択中はアイコンを `color-text-title` で描画。
- **フォーム領域**: 「どこにいったの?」「ひとこと」「タグ」はそれぞれ 56px 高の半透明行。下線はなし、代わりに `space-8` ギャップで余白確保。キャプションは Apple Notes 風に左側に 4px の淡色バーを配置。
- **Pin ボトムシート**: 高さ 60%。ヘッダーに `typo-title` のタイトルと閉じるアイコン (28px)。リストアイテムは 64px、アイコン 24px、地名は 2 行まで。背景 `blur(20px)` + 白 70%。位置候補の右側に距離 (例: 400m) を `typo-footnote` で表示。
- **詳細設定モーダル**: 画面中央に 520px 高のカード (iPhone 高さ前提)。訪問日時は iOS カレンダーのモーダル風に 2 段構成 (日付 48px + 時刻 48px picker)。同行者はリストアイテム 72px、アバター 40px。
- **トースト/モーション**: 投稿完了トーストは下部 120px 位置に表示。幅 320px、高さ 64px、背景 `rgba(37,102,255,0.92)`、テキスト白。`motion-hero` (spring) で上方からスライドイン。

## 実装メモ / 注意点
- カメラ/フォト権限エラーは `PermissionAlert` コンポーネントで対応し、透明な背景 + 2ボタン (設定/キャンセル) を表示。
- 画像 EXIF サジェストはモック `fixtures/pins.json` を使用。将来的にバックエンドと接続可能な構造で `locationId` を保持。
- タグ入力は日本語 IME を考慮し `onKeyPress` でスペース検知、確定前の変換中はチップ化しない。
- バリデーションは `zod` を利用し、140文字超過・タグ重複・写真未選択でエラーを返す。

## Definition of Done
- `PostImageGrid`, `TagInput`, `PostVisibilityMenu` のスナップショット/interaction テストが通る。
- 投稿成功/失敗/権限エラーのシナリオを Detox などの簡易 E2E で 1 ケースずつ実行。
- iOS26 (iPhone 15 Pro) / Android (Pixel 8) の録画を PR に添付し、ピッカー→投稿完了まで確認できる。
- PR でデザインレビュー・コードレビューを各1件取得。
- `yarn lint`・`yarn tsc --noEmit` が成功。
